<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Rafferty Parker (University of Otago)" />


<title>Analysis of electric vehicle usage patterns in New Zealand</title>

<script src="EVBB_Report_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="EVBB_Report_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="EVBB_Report_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="EVBB_Report_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="EVBB_Report_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="EVBB_Report_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="EVBB_Report_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="EVBB_Report_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="EVBB_Report_files/navigation-1.1/tabsets.js"></script>
<script src="EVBB_Report_files/navigation-1.1/codefolding.js"></script>
<link href="EVBB_Report_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="EVBB_Report_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Analysis of electric vehicle usage patterns in New Zealand</h1>
<h4 class="author"><em>Rafferty Parker (University of Otago)</em></h4>
<h4 class="date"><em>Last run at: 2019-01-16 13:47:58</em></h4>

</div>


<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>New Zealand’s total electricity demand varies throughout the day, with two distinct “peaks”; one in the morning, and one in the evening. Providing the electicity to meet these demand peaks is a costly and inefficient process. If poorly managed, the predicted increase in electric vehicles (EVs) may increase these daily peaks significantly, increasing the cost of electricity due to the requirement of expensive upgrades to the electricity grid<span class="citation">[@stephenson_smart_2017]</span>.</p>
<p>Our results showed that… [when/where is the greatest amount of charging occurring? What is the power demand per vehicle/household/place of charging? What might this look like if 50% of households had an EV? What about if it matched current ICE ownership (eventually)?]</p>
</div>
<div id="background" class="section level1">
<h1><span class="header-section-number">2</span> Background</h1>
<p>The New Zealand government has set a target of increasing the number of EVs in New Zealand to 64,000 by 2021. High penetration of EVs would cause EV recharging to contribute a substantial potion of total electricity load. A report prepared for lines companies Orion, Powerco and Unison by Concept Consulting Group entitled “Driving change - Issues and options to maximise the opportunities from large-scale electric vehicle uptake in New Zealand” predicts that if all current light private vehicles were electric, annual residential electricity consumption would increase by approximately 30%, whereas if all vehicles including trucks were electric, this would increase the total electricity consumption of New Zealand by approximately 41%[concept_2018]. Concurrent charging, especially in the early evening when many motorists return home, would have the potential to negatively impact the operation of the grid through drastically increasing peak loads [Azadfar2015].</p>
<p>The Concept Consulting report considers different methods of EV charging. The assumption that most drivers would begin charging immediately after returning home is referred to as “passive” charging, while charging that is programmed (either by the driver or by an external entity) to occur during off-peak periods is referred to as “smart”. The key findings of the report are as follows.</p>
<p>Under a scenario whereby 57% of the current private vehicle fleet were EVs (corresponding to one EV per household): * If all were charged in a passive fashion, New Zealand’s peak electricity demand would increase by appproximately 3,000MW * If all were charged in a “smart” fashion, there would be no increase in peak demand</p>
<p>This report extends the work done by Concept Consulting, but utilises actual data collected from electric vehicles, as opposed to using models based on current usage patterns of internal combustion engine (ICE) vehicles.</p>
<p>This is an example of a bibtex reference to a paper: <span class="citation">[@stephenson_smart_2017]</span></p>
<p>This is an example of a reference to an R package: <span class="citation">[@dplyr]</span></p>
</div>
<div id="research-questions" class="section level1">
<h1><span class="header-section-number">3</span> Research questions</h1>
<p>Need to find: * The median average energy supplied by domestic charging events Compare with UK findings og was 7.5 kWh. If NZ findings are higher, it may be due to UK having more plug-in hybrids. * The mean average energy supplied Compare with UK findings of 9.1 kWh. * Charging duration time each day of week * Time of day that charging begins by day of week * Plot time of day charging begins and time of day charging ends (weekend/weekday?) * Plot average energy supplied by hour of start time (fast/slow charging) * plot average duration of plug-in by hour of start time (fast/slow charging) * Average energy use per vehicle per month * Average number of charging events per vehicle per day for each day of week * Average number of events per vehicle per w eek * Median/mean amount of energy supplied per day of week (may not be easy to exactly determine)</p>
</div>
<div id="methods" class="section level1">
<h1><span class="header-section-number">4</span> Methods</h1>
<div id="data" class="section level2">
<h2><span class="header-section-number">4.1</span> Data</h2>
<p>Describe it:</p>
<p>The data used has been provided by “Flip the Fleet”, a community organisation that hopes to increase uptake of electric vehicles in New Zealand. Flip the Fleet have been collecting data on electric vehicle usage patterns, collected using Exact IOT Limited’s “Black Box”, a small electronic device that connects to the vehicle’s internal computer and sends detailed data about the battery health, consumption, speed, etc.</p>
<p>The data has been anonymised through the hashing of license plate numbers and dates.</p>
<p>Charging data has been broadly seperated into two seperate catagories, “slow” and “fast”. Slow charging is when the charger is reading less than 7kW - this is considered the upper limit of what can be obtained from a standard home charging scenario without an expensive wiring upgrade. Fast charging is all charging above 7kW, and would likely occur at designated and purpose-built fast charging stations.</p>
<p>Grid peaks are more pronounced during weekdays. Because of this, the data was also catagorised according to whether it was a weekday or not. This allows analysis to occur of differing charging patterns between weekdays and weekends, allowing for further accuracy in determining the effects of grid peaks.</p>
<ul>
<li>where did you get it?</li>
<li>how many vehicles, where are they and what kinds?</li>
<li>anything we need to know about the data?</li>
<li>what did you have to do to it (cleaning etc)</li>
<li>descriptive analysis, e.g.:</li>
<li>Plot all charging with fast and slow charges differentiated</li>
<li>Plot fast charges with weekend and weekday differentiated</li>
<li>Histograms of power (kW)</li>
</ul>
<p>Load the data - note the feedback readr gives you on the assumed format of the columns. You might <em>not</em> want to remove the original dateTime :-)</p>
<pre class="r"><code>df &lt;- readr::read_csv(dFile)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   id = col_character(),
##   dayid = col_character(),
##   month = col_character(),
##   day_of_week = col_character(),
##   time = col_time(format = &quot;&quot;),
##   fractime = col_double(),
##   charge_power_kw = col_double(),
##   state_of_charge_percent = col_double(),
##   odometer_km = col_double(),
##   location = col_logical()
## )</code></pre>
<p>This is a cross-references to Table <a href="#tab:tab1">4.1</a>.</p>
<pre class="r"><code>t &lt;- summary(df)

knitr::kable(t, caption = &quot;Data summary&quot;) # &lt;- makes a pretty table</code></pre>
<table>
<caption><span id="tab:tab1">Table 4.1: </span>Data summary</caption>
<thead>
<tr class="header">
<th></th>
<th align="center">id</th>
<th align="center">dayid</th>
<th align="center">month</th>
<th align="left">day_of_week</th>
<th align="center">time</th>
<th align="center">fractime</th>
<th align="left">charge_power_kw</th>
<th align="left">state_of_charge_percent</th>
<th align="center">odometer_km</th>
<th align="left">location</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td align="center">Length:73836</td>
<td align="center">Length:73836</td>
<td align="center">Length:73836</td>
<td align="left">Length:73836</td>
<td align="center">Length:73836</td>
<td align="center">Min. : 0.000</td>
<td align="left">Min. : 0.000</td>
<td align="left">Min. : 0.00</td>
<td align="center">Min. : 0</td>
<td align="left">Mode:logical</td>
</tr>
<tr class="even">
<td></td>
<td align="center">Class :character</td>
<td align="center">Class :character</td>
<td align="center">Class :character</td>
<td align="left">Class :character</td>
<td align="center">Class1:hms</td>
<td align="center">1st Qu.: 6.027</td>
<td align="left">1st Qu.: 0.000</td>
<td align="left">1st Qu.: 55.54</td>
<td align="center">1st Qu.:1385</td>
<td align="left">NA’s:73836</td>
</tr>
<tr class="odd">
<td></td>
<td align="center">Mode :character</td>
<td align="center">Mode :character</td>
<td align="center">Mode :character</td>
<td align="left">Mode :character</td>
<td align="center">Class2:difftime</td>
<td align="center">Median :13.528</td>
<td align="left">Median : 2.772</td>
<td align="left">Median : 69.83</td>
<td align="center">Median :2716</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td></td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="left">NA</td>
<td align="center">Mode :numeric</td>
<td align="center">Mean :12.676</td>
<td align="left">Mean : 2.149</td>
<td align="left">Mean : 68.54</td>
<td align="center">Mean :3116</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td></td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="left">NA</td>
<td align="center">NA</td>
<td align="center">3rd Qu.:18.178</td>
<td align="left">3rd Qu.: 3.025</td>
<td align="left">3rd Qu.: 83.19</td>
<td align="center">3rd Qu.:4435</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td></td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="left">NA</td>
<td align="center">NA</td>
<td align="center">Max. :23.999</td>
<td align="left">Max. :49.354</td>
<td align="left">Max. :1677.72</td>
<td align="center">Max. :8254</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td></td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="left">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="center">NA’s :53206</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code>df$day_of_week &lt;- factor(df$day_of_week, ordered = TRUE,
                                     levels = c(&quot;Monday&quot;, &quot;Tuesday&quot;, &quot;Wednesday&quot;,&quot;Thursday&quot;,
                                                &quot;Friday&quot;, &quot;Saturday&quot;, &quot;Sunday&quot;)) 
df$month &lt;- factor(df$month, ordered = TRUE, levels = c(&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;,
                                                        &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;,
                                                        &quot;Nov&quot;, &quot;Dec&quot;))

weekdays1 &lt;- c(&quot;Monday&quot;, &quot;Tuesday&quot;, &quot;Wednesday&quot;, &quot;Thursday&quot;, &quot;Friday&quot;)
df$weekday &lt;- factor((df$day_of_week %in% weekdays1), 
                   levels = c(TRUE, FALSE), labels = c(&#39;Weekday&#39;, &#39;Weekend&#39;), ordered = TRUE) 

df$charging_rate &lt;- cut(df$charge_power_kw, c(-Inf, 0.01, 7, Inf), labels = c(&#39;None&#39;, &#39;Slow&#39;, &#39;Fast&#39;))</code></pre>
<pre class="r"><code># code to half (or quarter) hours, removing seconds from formatting

df$halfHour &lt;- format(as.POSIXct(hms::trunc_hms(df$time, 30*60)), &quot;%H:%M&quot;)
df$quarterHour &lt;- format(as.POSIXct(hms::trunc_hms(df$time, 15*60)), &quot;%H:%M&quot;)</code></pre>
<pre class="r"><code>df$id &lt;- factor(df$id, ordered = TRUE)
levSeq &lt;- seq(1:length(levels(df$id)))
levSeqChar &lt;- as.character(levSeq)

df$id &lt;- factor(df$id,
  labels = levSeqChar)

df$id &lt;- as.character(df$id)

df$id &lt;- paste(&quot;Vehicle&quot;, df$id, sep = &quot; &quot;)


# It *might* be useful to do a similar thing with dayid, however it appears there is a seperate dayid per car per day (not same for different cars on same day)
# This would be unnecessary if I get a proper datetime stamp</code></pre>
<pre class="r"><code>df$state_of_charge_percent[df$state_of_charge_percent &gt; 100] &lt;- NA
df$state_of_charge_percent[df$state_of_charge_percent &lt; 0] &lt;- NA</code></pre>
<p>The following dataframe “chargeBegins” is constructed out of all the instances where charging becomes non-zero after previously being zero, hopefully capturing the moment the car is initially plugged in. Data is also excluded where charging has stopped due to the car being fully charged and then starts again briefly, charging is turned off or on, etc. Extra lag of 2 was provided due to some instances where there was only one minute where charging occurred, presumably due to regenerative braking. This should be useful for establishing average state of charge when arriving home. Similarly, “chargeEnds” hopefully captures the time at which the vehicle becomes fully charged. Note that the discrepency between the number of “charge begins” events and “charge ends” events indicated that there may be a better way of defining these.</p>
<pre class="r"><code>chargeBegins &lt;- filter(df, charge_power_kw &gt; 0.1 &amp; lag(charge_power_kw) &lt; 0.1 &amp;
                         lag(charge_power_kw, 2) &lt; 0.1)
chargeBegins &lt;- filter(chargeBegins, state_of_charge_percent &lt; 97)

chargeEnds &lt;- filter(df, charge_power_kw &gt; 0.1 &amp; lead(charge_power_kw) &lt; 0.1 &amp; lead(charge_power_kw, 2) &lt; 0.1)
chargeEnds &lt;- filter(chargeEnds, state_of_charge_percent &lt; 97)

# Not sure why there are so many more instances of charge beginning than charge ending</code></pre>
<pre class="r"><code>dayCount &lt;- table(df$day_of_week)
png(filename=&quot;~/EVBB/plots/day_count.png&quot;)
barplot(dayCount)
dev.off()</code></pre>
<pre><code>## png 
##   2</code></pre>
<p><img src="plots/day_count.png" alt="Count of data by day" /> The above figure demonstrates that that for the current data set there is a disparity in the number of data points for each day, making analysis of averages etc difficult.</p>
<pre class="r"><code>#Mean and median kW demand per day by day of the week (Bar charts, one for fast charging one for slow)</code></pre>
<pre class="r"><code># This entire block is garbage, will probably need deleting

# perhaps best way to do this:
# create factor where all zero charge values are NC, all non-zero are MC
# then create factors for BC and EC using filter method from previous block
# to overwrite beginning and end MC values

#df$charge_factor &lt;- cut(df$charge_power_kw, c(-Inf, 0.01, Inf), labels = c(&#39;NC&#39;, &#39;MC&#39;))


#chargeBegins &lt;- filter(df, charge_power_kw &gt; 0 &amp; lag(charge_power_kw) == 0 
#                       &amp; lag(charge_power_kw, 2) == 0)
#chargeBegins &lt;- filter(chargeBegins, state_of_charge_percent &lt; 97)

#chargeEnds &lt;- filter(df, charge_power_kw &lt; 0.1 &amp; lag(charge_power_kw) &gt; 1) 



#if (df$charge_power_kw &gt; 0.1 &amp; lag(df$charge_power_kw) &lt; 0.1){
#  df$charge_factor &lt;- &quot;BC&quot;
#} else if (df$charge_power_kw &gt; 0.1 &amp; lead(df$charge_power_kw) &lt; 0.1){
#  df$charge_factor &lt;- &quot;EC&quot;}



#if (df$charge_power_kw &lt; 0.1){
#  df$charge_factor &lt;- &quot;NC&quot;
#} else if (df$charge_power_kw &gt; 0.1 &amp; lag(df$charge_power_kw) &lt; 0.1){
#  df$charge_factor &lt;- &quot;BC&quot;
#} else if (df$charge_power_kw &gt; 0.1 &amp; lead(df$charge_power_kw) &lt; 0.1){
#  df$charge_factor &lt;- &quot;EC&quot;
# else
#  df$charge_factor &lt;- &quot;MC&quot;


#df$charge_factors &lt;- filter(df)</code></pre>
<pre class="r"><code>#  As timestanp scrambled we would need to work out average per day and then times this by 365/12 to get monthly average</code></pre>
<pre class="r"><code>p &lt;- ggplot(data=chargeBegins, aes(chargeBegins$state_of_charge_percent)) + geom_histogram(bins = 10)
p + labs(x = &quot;State of charge when charging begins (%)&quot;)</code></pre>
<p><img src="EVBB_Report_files/figure-html/value%20of%20state%20of%20charge%20at%20beginning%20of%20charge-1.png" width="672" /></p>
<pre class="r"><code>startCount &lt;- table(chargeBegins$day_of_week)
barplot(startCount, main=&quot;Charging start times&quot;)</code></pre>
<p><img src="EVBB_Report_files/figure-html/bar%20plots%20of%20charging%20start%20times-1.png" width="672" /></p>
<pre class="r"><code>endCount &lt;- table(chargeEnds$day_of_week)
barplot(endCount, main = &quot;Charging end times&quot;)</code></pre>
<p><img src="EVBB_Report_files/figure-html/bar%20plots%20of%20charging%20start%20times-2.png" width="672" /></p>
<pre class="r"><code># NOTE I am very skeptical of these, I think the previous block (that constructs chargeBegins/Ends) needs improving upon
# Also the &quot;count&quot; on the y axis is pretty meaningless, perhaps it would be good to (for example) divide by number of vehicles and then perhaps number of months, then change the title to &quot; Monthly average charging start times&quot;. Alternatively just remove the numbers.</code></pre>
<p>Figure <a href="#fig:plot1">4.1</a> implies that most charging is “slow”.</p>
<pre class="r"><code>p &lt;- ggplot2::ggplot(df, aes(x = charge_power_kw)) +
  guides(colour = guide_legend(title = &quot;Vehicle:&quot;)) +
  theme(legend.position=&quot;bottom&quot;) +
  scale_colour_manual(values=cbPalette) + # use colour-blind friendly palette
  geom_density() # &lt;- make the plot in an object first

p + labs(x = &quot;Power (kW)&quot;) + facet_grid(id ~ .) +
    annotate(&quot;rect&quot;, xmin = 0, xmax = 7, ymin = 0, ymax = 1.5,
           alpha = .1, fill=&quot;yellow&quot;) +
  annotate(&quot;rect&quot;, xmin = 7, xmax = 50, ymin = 0, ymax = 1.5,
           alpha = .1, fill=&quot;blue&quot;) +
  annotate(&quot;text&quot;,label=&quot;Slow&quot;, x=3.5, y=1.25, angle=0) +
  annotate(&quot;text&quot;,label=&quot;Fast&quot;, x=(50-7)/2 + 7, y=1.25, angle=0)</code></pre>
<div class="figure"><span id="fig:plot1"></span>
<img src="EVBB_Report_files/figure-html/plot1-1.png" alt="Density plot of charging power by car" width="672" />
<p class="caption">
Figure 4.1: Density plot of charging power by car
</p>
</div>
<pre class="r"><code># Not sure the annotations are really necessary but will leave them for now
# Also probably don&#39;t need two different colours for each car
# Need to alter settings so that fast charges are visible</code></pre>
</div>
<div id="analysis" class="section level2">
<h2><span class="header-section-number">4.2</span> Analysis</h2>
<p>Analysis was conducted using R (R version 3.4.4 (2018-03-15)) and the following packages:</p>
<ul>
<li>ggplot2 <span class="citation">[@ggplot2]</span></li>
<li>dplyr <span class="citation">[@dplyr]</span></li>
</ul>
<p>Reports were developed using knitr <span class="citation">[@knitr]</span> within bookdown <span class="citation">[@bookdown]</span>.</p>
</div>
</div>
<div id="charging-analysis" class="section level1">
<h1><span class="header-section-number">5</span> Charging Analysis</h1>
<div id="research-question-1" class="section level2">
<h2><span class="header-section-number">5.1</span> Research question 1</h2>
<p>When does charging happen?</p>
<p>This is a cross-reference to Figure <a href="#fig:plot2">5.1</a>. Time is coded to half hours.</p>
<pre class="r"><code>p &lt;- ggplot2::ggplot(df, aes(x = halfHour, group = halfHour, y = charge_power_kw)) +
  guides(colour = guide_legend(title = &quot;Vehicle:&quot;)) +
  theme(legend.position = &quot;bottom&quot;, axis.text.x = element_text(angle = 90)) +
  scale_colour_manual(values=cbPalette) + # use colour-blind friendly palette
  geom_boxplot() # &lt;- make the plot in an object first

p + labs(x = &quot;Time of Day&quot;, y = &quot;Power (kW)&quot;) + facet_grid(day_of_week ~ id)</code></pre>
<div class="figure"><span id="fig:plot2"></span>
<img src="EVBB_Report_files/figure-html/plot2-1.png" alt="Boxplot of charging timing by car" width="672" />
<p class="caption">
Figure 5.1: Boxplot of charging timing by car
</p>
</div>
<pre class="r"><code>p &lt;- ggplot2::ggplot(df, aes(x = halfHour, group = halfHour, y = charge_power_kw)) +
  guides(colour = guide_legend(title = &quot;Vehicle:&quot;)) +
  theme(legend.position = &quot;bottom&quot;, axis.text.x = element_text(angle = 90)) +
  scale_colour_manual(values=cbPalette) + # use colour-blind friendly palette
  geom_boxplot() # &lt;- make the plot in an object first

p + labs(x = &quot;Time of Day&quot;, y = &quot;Power (kW)&quot;) + facet_grid(day_of_week ~ charging_rate)</code></pre>
<div class="figure"><span id="fig:plot3"></span>
<img src="EVBB_Report_files/figure-html/plot3-1.png" alt="Boxplot of charging timing by charge rate" width="672" />
<p class="caption">
Figure 5.2: Boxplot of charging timing by charge rate
</p>
</div>
<pre class="r"><code># let the rhs panel have a free y axis to see the patterns - as they are scaled down by the magnitude of the fast charging. </code></pre>
<pre class="r"><code>p &lt;- ggplot2::ggplot(df %&gt;% filter(charging_rate == &quot;Fast&quot;), aes(x = halfHour, group = halfHour, y = charge_power_kw)) +
  guides(colour = guide_legend(title = &quot;Vehicle:&quot;)) +
  theme(legend.position = &quot;bottom&quot;, axis.text.x = element_text(angle = 90)) +
  scale_colour_manual(values=cbPalette) + # use colour-blind friendly palette
  geom_boxplot() +
  facet_grid(~day_of_week)

p + labs(x = &quot;Time of Day&quot;, y = &quot;Power (kW)&quot;)</code></pre>
<div class="figure"><span id="fig:plot3a"></span>
<img src="EVBB_Report_files/figure-html/plot3a-1.png" alt="Boxplot of daily fast charging" width="672" />
<p class="caption">
Figure 5.3: Boxplot of daily fast charging
</p>
</div>
<pre class="r"><code>ggsave(&quot;~/EVBB/plots/daily_fast_charging.png&quot;)</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
<pre class="r"><code># poor scaling </code></pre>
<pre class="r"><code>p &lt;- ggplot2::ggplot(df %&gt;% filter(charging_rate == &quot;Slow&quot;), 
                     aes(x = halfHour, group = halfHour, y = charge_power_kw)) +
  guides(colour = guide_legend(title = &quot;Vehicle:&quot;)) +
  theme(legend.position = &quot;bottom&quot;, axis.text.x = element_text(angle = 90)) +
  scale_colour_manual(values=cbPalette) + # use colour-blind friendly palette
  geom_boxplot() +
  facet_grid(~day_of_week) 

p + labs(x = &quot;Time of Day&quot;, y = &quot;Power (kW)&quot;) + coord_flip()</code></pre>
<div class="figure"><span id="fig:plot3b"></span>
<img src="EVBB_Report_files/figure-html/plot3b-1.png" alt="Boxplot of daily slow charging" width="672" />
<p class="caption">
Figure 5.4: Boxplot of daily slow charging
</p>
</div>
<pre class="r"><code># Not sure the coord_flip is beneficial

ggsave(&quot;~/EVBB/plots/daily_slow_charging.png&quot;)</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
<pre class="r"><code>p &lt;- ggplot2::ggplot(df %&gt;% filter(charging_rate == &quot;Slow&quot;), aes(x = halfHour, group = halfHour, y = charge_power_kw)) +
  guides(colour = guide_legend(title = &quot;Vehicle:&quot;)) +
  theme(legend.position = &quot;bottom&quot;, axis.text.x = element_text(angle = 90)) +
  scale_colour_manual(values=cbPalette) + # use colour-blind friendly palette
  geom_boxplot() +
  facet_grid(~weekday)

p + labs(x = &quot;Time of Day&quot;, y = &quot;Power (kW)&quot;)</code></pre>
<div class="figure"><span id="fig:plot3c"></span>
<img src="EVBB_Report_files/figure-html/plot3c-1.png" alt="Boxplot of weekday/weekend slow charging" width="672" />
<p class="caption">
Figure 5.5: Boxplot of weekday/weekend slow charging
</p>
</div>
<pre class="r"><code>ggsave(&quot;~/EVBB/plots/weekday_weekend_slow_charging.png&quot;)</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
<pre class="r"><code>p &lt;- ggplot2::ggplot(df %&gt;% filter(charging_rate == &quot;Fast&quot;), aes(x = halfHour, group = halfHour, y = charge_power_kw)) +
  guides(colour = guide_legend(title = &quot;Vehicle:&quot;)) +
  theme(legend.position = &quot;bottom&quot;, axis.text.x = element_text(angle = 90)) +
  scale_colour_manual(values=cbPalette) + # use colour-blind friendly palette
  geom_boxplot() +
  facet_grid(~weekday)

p + labs(x = &quot;Time of Day&quot;, y = &quot;Power (kW)&quot;)</code></pre>
<div class="figure"><span id="fig:plot3d"></span>
<img src="EVBB_Report_files/figure-html/plot3d-1.png" alt="Boxplot of weekday/weekend fast charging" width="672" />
<p class="caption">
Figure 5.6: Boxplot of weekday/weekend fast charging
</p>
</div>
<pre class="r"><code>ggsave(&quot;~/EVBB/plots/weekday_weekend_fast_charging.png&quot;)</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
<pre class="r"><code># Not obvious that no overnight charging occurring</code></pre>
<pre class="r"><code>p &lt;- ggplot2::ggplot(df, aes(x = halfHour, group = halfHour, y = charge_power_kw)) +
  guides(colour = guide_legend(title = &quot;Vehicle:&quot;)) +
  scale_colour_manual(values=cbPalette) + # use colour-blind friendly palette
  geom_boxplot() +
  stat_summary(aes(group = weekday), fun.y=mean, geom=&quot;line&quot;, colour = &quot;red&quot;) +
  coord_cartesian(xlim = c(0,24),ylim=c(0,15))

p + labs(x = &quot;Time of Day&quot;, y = &quot;Power (kW)&quot;) + facet_grid(~weekday) +  theme(legend.position = &quot;bottom&quot;, axis.text.x = element_text(angle = 90)) </code></pre>
<div class="figure"><span id="fig:plot4"></span>
<img src="EVBB_Report_files/figure-html/plot4-1.png" alt="Weekend and weekday charging patterns" width="672" />
<p class="caption">
Figure 5.7: Weekend and weekday charging patterns
</p>
</div>
<pre class="r"><code># might need to split by location as this would tell us a) about slow charge by default and b) about home vs non-home LV network impacts</code></pre>
<pre class="r"><code>p &lt;- ggplot(df %&gt;% filter(charging_rate == &quot;Fast&quot;), aes(x = charge_power_kw)) + 
  guides(colour = guide_legend(title = &quot;Vehicle:&quot;)) +
  scale_colour_manual(values=cbPalette) + # use colour-blind friendly palette
  geom_histogram()
 
p + labs(x = &quot;Charging power (kW)&quot;, y = &quot;Frequency of occurrence&quot;) + facet_wrap(~weekday) </code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="EVBB_Report_files/figure-html/fastcharge%20only-1.png" width="672" /></p>
<pre class="r"><code>p &lt;- ggplot(df %&gt;% filter(charging_rate == &quot;Slow&quot;) , aes(x = halfHour, y = charging_rate)) + 
  theme(axis.text.x = element_text(angle = 90)) +
  geom_bar(stat = &quot;identity&quot;)
 
p + labs(x = &quot;Time of day (hours)&quot;, y = &quot;Frequency of slow charging events&quot;) + 
  facet_wrap(~weekday) </code></pre>
<p><img src="EVBB_Report_files/figure-html/frequency%20of%20slow%20charging-1.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;~/EVBB/plots/frequency_of_slow_charging.png&quot;)</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
<pre class="r"><code>p &lt;- ggplot(df %&gt;% filter(charging_rate == &quot;Fast&quot;) , aes(x = halfHour, y = charging_rate)) + 
  facet_wrap(~weekday) + 
  theme(axis.text.x = element_text(angle = 90)) +
  geom_bar(stat = &quot;identity&quot;)

p + labs(x = &quot;Time of day (hours)&quot;, y = &quot;Frequency of fast charging events&quot;)</code></pre>
<p><img src="EVBB_Report_files/figure-html/frequency%20of%20fast%20charging-1.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;~/EVBB/plots/frequency_of_fast_charging.png&quot;)</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
<pre class="r"><code>#  stat_summary(aes(group = weekday), fun.y=mean, geom=&quot;line&quot;) +</code></pre>
</div>
</div>
<div id="state-of-charge-patterns" class="section level1">
<h1><span class="header-section-number">6</span> State of charge patterns</h1>
<p>When analysing the potential for smart charging it is useful to understand daily patterns of the vehicle’s “state of charge”, in particular the percentage of energy left in the battery once the vehicle returns home. This is of particular significance when considering vehicle to grid (V2G) energy transfer. If there is a very high frequency whereby the driver only uses a particular percentage of the battery capacity in a day, there may be the ability to return electricity to the grid (or household) during grid congestion events or other occasions of very high electricity price, provided enough energy always remained in the battery for a typical day of travel.</p>
<p>Figure @ref(plot:charging density plot by vehicle) shows a box plot of state of charge during the day. (Note that the zero values may be false - there seem to be no values that approach zero)</p>
<pre class="r"><code>p &lt;- ggplot2::ggplot(df, aes(x = halfHour, group = halfHour, y = state_of_charge_percent)) +
  guides(colour = guide_legend(title = &quot;Vehicle:&quot;)) +
  theme(legend.position = &quot;bottom&quot;, axis.text.x = element_text(angle = 90)) +
  scale_colour_manual(values=cbPalette) + # use colour-blind friendly palette
  geom_boxplot() # &lt;- make the plot in an object first
p + labs(x = &quot;Time of day&quot;, y = &quot;State of charge (%)&quot;)</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="EVBB_Report_files/figure-html/charging%20density%20plot%20by%20vehicle-1.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;~/EVBB/plots/SOC_when_charging_begins.png&quot;)</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_boxplot).</code></pre>
</div>
<div id="density-plot-of-half-hour-values-see-when-data-is-being-collected" class="section level1">
<h1><span class="header-section-number">7</span> Density plot of half-hour values (see when data is being collected)</h1>
<pre class="r"><code>p &lt;- ggplot2::ggplot(df, aes(x = halfHour, group = halfHour, y = state_of_charge_percent)) +
  guides(colour = guide_legend(title = &quot;Vehicle:&quot;)) +
  scale_colour_manual(values=cbPalette) + # use colour-blind friendly palette
  geom_boxplot() +
  stat_summary(aes(group = weekday), fun.y=mean, geom=&quot;line&quot;, colour = &quot;red&quot;)

p + labs(x = &quot;Time of Day&quot;, y = &quot;State of charge (%)&quot;) + facet_grid(~weekday) +  theme(legend.position = &quot;bottom&quot;, axis.text.x = element_text(angle = 90)) </code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_boxplot).</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_summary).</code></pre>
<p><img src="EVBB_Report_files/figure-html/State%20of%20charge%20by%20weekend/weekday-1.png" width="672" /></p>
<p>Need to get average SOC when charging begins. To do this, we will select all data whereby the charging rate is non-zero, but the previous charge rate is zero</p>
<div id="research-question-2" class="section level2">
<h2><span class="header-section-number">7.1</span> Research question 2</h2>
<p>How might this affect the NZ electricity grid?</p>
</div>
</div>
<div id="conclusions" class="section level1">
<h1><span class="header-section-number">8</span> Conclusions</h1>
</div>
<div id="references" class="section level1">
<h1><span class="header-section-number">9</span> References</h1>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
